<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title><%= title %></title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        padding: 40px;
        color: #1f2937;
        background: #ffffff;
        line-height: 1.6;
      }

      .header {
        background: linear-gradient(135deg, #3a2d9c 0%, #017977 100%);
        color: white;
        padding: 40px;
        border-radius: 16px;
        margin-bottom: 40px;
        box-shadow: 0 10px 30px rgba(58, 45, 156, 0.15);
      }

      .header h1 {
        font-size: 32px;
        font-weight: 800;
        margin-bottom: 12px;
        letter-spacing: -0.5px;
      }

      .header .subtitle {
        font-size: 14px;
        opacity: 0.95;
        font-weight: 500;
      }

      .generated-date {
        display: inline-block;
        background: rgba(255, 255, 255, 0.15);
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 13px;
        margin-top: 16px;
        font-weight: 500;
      }

      .section {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      }

      .section-title {
        display: flex;
        align-items: center;
        font-size: 20px;
        font-weight: 700;
        color: #111827;
        margin-bottom: 24px;
        padding-bottom: 12px;
        border-bottom: 2px solid #f3f4f6;
      }

      .section-title .icon {
        font-size: 24px;
        margin-right: 12px;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
      }

      .info-item {
        background: #f9fafb;
        padding: 16px 20px;
        border-radius: 10px;
        border-left: 4px solid #3a2d9c;
      }

      .info-label {
        font-size: 12px;
        font-weight: 600;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 6px;
      }

      .info-value {
        font-size: 16px;
        font-weight: 600;
        color: #111827;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
        border: 1px solid #e5e7eb;
        padding: 24px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
      }

      .stat-label {
        font-size: 13px;
        font-weight: 600;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 10px;
      }

      .stat-value {
        font-size: 36px;
        font-weight: 800;
        color: #3a2d9c;
        line-height: 1;
      }

      .plan-badge {
        display: inline-block;
        background: linear-gradient(135deg, #3a2d9c 0%, #017977 100%);
        color: white;
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 700;
        margin-left: 8px;
      }

      .days-remaining {
        display: inline-block;
        background: #10b981;
        color: white;
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 700;
        margin-left: 8px;
      }

      .days-remaining.warning {
        background: #f59e0b;
      }

      .days-remaining.critical {
        background: #ef4444;
      }

      table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-top: 16px;
        font-size: 12px;
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        overflow: hidden;
      }

      thead {
        background: linear-gradient(135deg, #3a2d9c 0%, #017977 100%);
      }

      th {
        padding: 14px 16px;
        text-align: left;
        font-weight: 700;
        font-size: 12px;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      tbody tr {
        border-bottom: 1px solid #f3f4f6;
      }

      tbody tr:last-child {
        border-bottom: none;
      }

      tbody tr:nth-child(even) {
        background-color: #f9fafb;
      }

      tbody tr:hover {
        background-color: #f3f4f6;
      }

      td {
        padding: 12px 16px;
        color: #374151;
        vertical-align: top;
      }

      td:first-child {
        font-weight: 600;
        color: #111827;
      }

      .sender-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .sender-user {
        background: #dbeafe;
        color: #1e40af;
      }

      .sender-bot {
        background: #d1fae5;
        color: #065f46;
      }

      .message-content {
        word-wrap: break-word;
        line-height: 1.6;
        font-size: 12px;
      }

      /* Markdown styles for message content */
      .message-content p {
        margin: 0.4em 0;
      }

      .message-content p:first-child {
        margin-top: 0;
      }

      .message-content p:last-child {
        margin-bottom: 0;
      }

      .message-content strong {
        font-weight: 700;
        color: #111827;
      }

      .message-content em {
        font-style: italic;
        color: #4b5563;
      }

      .message-content code {
        background-color: #f3f4f6;
        color: #ef4444;
        padding: 2px 5px;
        border-radius: 3px;
        font-size: 11px;
        font-family: 'Courier New', Courier, monospace;
        font-weight: 500;
      }

      .message-content pre {
        background-color: #1f2937;
        color: #f9fafb;
        padding: 10px;
        border-radius: 6px;
        overflow-x: auto;
        margin: 6px 0;
        border: 1px solid #374151;
      }

      .message-content pre code {
        background-color: transparent;
        color: #f9fafb;
        padding: 0;
        font-size: 11px;
      }

      .message-content ul,
      .message-content ol {
        margin: 0.4em 0;
        padding-left: 20px;
      }

      .message-content li {
        margin: 0.2em 0;
        line-height: 1.5;
      }

      .message-content a {
        color: #3a2d9c;
        text-decoration: underline;
        font-weight: 500;
      }

      .message-content h1,
      .message-content h2,
      .message-content h3,
      .message-content h4,
      .message-content h5,
      .message-content h6 {
        font-weight: 700;
        margin: 0.6em 0 0.3em 0;
        color: #111827;
      }

      .message-content h1 {
        font-size: 15px;
      }

      .message-content h2 {
        font-size: 14px;
      }

      .message-content h3 {
        font-size: 13px;
      }

      .message-content h4,
      .message-content h5,
      .message-content h6 {
        font-size: 12px;
      }

      .message-content blockquote {
        border-left: 3px solid #3a2d9c;
        padding: 8px 12px;
        margin: 6px 0;
        font-style: italic;
        background: #f9fafb;
        border-radius: 4px;
        color: #4b5563;
      }

      .message-content table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin: 6px 0;
        font-size: 11px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        overflow: hidden;
      }

      .message-content th,
      .message-content td {
        border: 1px solid #e5e7eb;
        padding: 6px 8px;
        text-align: left;
      }

      .message-content th {
        background: linear-gradient(135deg, #3a2d9c 0%, #017977 100%);
        color: white;
        font-weight: 700;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .message-content tr:nth-child(even) {
        background-color: #f9fafb;
      }

      .message-content hr {
        border: none;
        border-top: 1px solid #e5e7eb;
        margin: 8px 0;
      }

      .footer {
        margin-top: 50px;
        padding-top: 30px;
        border-top: 2px solid #e5e7eb;
        text-align: center;
        color: #9ca3af;
        font-size: 12px;
      }

      .footer strong {
        color: #3a2d9c;
        font-weight: 700;
      }

      .empty-state {
        text-align: center;
        padding: 40px;
        color: #9ca3af;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <h1><%= title %></h1>
      <div class="subtitle">Comprehensive Analytics & Performance Report</div>
      <div class="generated-date">
        üìÖ Generated on: <%= generatedOn %>
      </div>
    </div>

    <!-- Company Details Section -->
    <div class="section">
      <div class="section-title">
        <span class="icon">üè¢</span>
        Company Information
      </div>
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Company Name</div>
          <div class="info-value"><%= company.name %></div>
        </div>
        <div class="info-item">
          <div class="info-label">Email Address</div>
          <div class="info-value"><%= company.email %></div>
        </div>
        <div class="info-item" style="grid-column: span 2;">
          <div class="info-label">Domain</div>
          <div class="info-value"><%= company.domain %></div>
        </div>
      </div>
    </div>

    <!-- Plan Details Section -->
    <div class="section">
      <div class="section-title">
        <span class="icon">üì¶</span>
        Subscription Plan
      </div>
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Current Plan</div>
          <div class="info-value">
            <%= plan.name %>
            <span class="plan-badge">ACTIVE</span>
          </div>
        </div>
        <div class="info-item">
          <div class="info-label">Plan Duration</div>
          <div class="info-value"><%= plan.duration_days %> Days</div>
        </div>
        <div class="info-item">
          <div class="info-label">Days Remaining</div>
          <div class="info-value">
            <%= plan.days_remaining %>
            <span class="days-remaining <%= plan.days_remaining < 7 ? 'critical' : plan.days_remaining < 30 ? 'warning' : '' %>">
              <%= plan.days_remaining %> Days Left
            </span>
          </div>
        </div>
        <div class="info-item">
          <div class="info-label">Maximum Users</div>
          <div class="info-value"><%= plan.max_users %></div>
        </div>
      </div>
    </div>

    <!-- Usage Statistics Section -->
    <div class="section">
      <div class="section-title">
        <span class="icon">üìä</span>
        Usage Analytics
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Messages</div>
          <div class="stat-value"><%= usage.total_messages %></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Users</div>
          <div class="stat-value"><%= usage.total_sessions || 0 %></div>
        </div>
      </div>
    </div>

    <!-- Message History Section -->
    <div class="section">
      <div class="section-title">
        <span class="icon">üí¨</span>
        Recent Message History
        <span style="font-size: 14px; font-weight: 500; color: #6b7280; margin-left: auto;">(Last 50 Messages)</span>
      </div>
      <% if (messages && messages.length > 0) { %>
        <table>
          <thead>
            <tr>
              <th style="width: 20%;">Timestamp</th>
              <th style="width: 15%;">Sender</th>
              <th style="width: 65%;">Message</th>
            </tr>
          </thead>
          <tbody>
            <% messages.forEach((msg) => { %>
              <tr>
                <td><%= new Date(msg.timestamp).toLocaleString() %></td>
                <td>
                  <span class="sender-badge <%= msg.sender === 'user' ? 'sender-user' : 'sender-bot' %>">
                    <%= msg.sender === 'user' ? 'USER' : 'AGENT' %>
                  </span>
                </td>
                <td class="message-content"><%- msg.contentHtml || msg.content || '' %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <div class="empty-state">
          üì≠ No messages available for this period
        </div>
      <% } %>
    </div>

    <!-- Footer -->
    <div class="footer">
      <strong>AI Agent</strong> - Agent Analytics Report<br>
      This report is confidential and intended solely for authorized personnel.
    </div>
  </body>
</html>
